# pentest_tools.py
# Lightweight reconnaissance tools (HTTP Headers, DNS).

import socket
import requests
import logging

def analyze_web_headers(target: str):
    """
    Checks HTTP security headers for a target domain/IP.
    """
    # Ensure scheme
    if not target.startswith("http"):
        url = f"http://{target}"
    else:
        url = target

    results = {"target": url, "headers": {}, "missing_security": []}
    
    # Important security headers to check
    security_headers = [
        "Strict-Transport-Security",
        "Content-Security-Policy",
        "X-Frame-Options",
        "X-Content-Type-Options",
        "X-XSS-Protection"
    ]

    try:
        # Short timeout to keep it fast
        r = requests.get(url, timeout=5)
        results["headers"] = dict(r.headers)
        results["server"] = r.headers.get("Server", "Unknown")
        
        for h in security_headers:
            if h not in r.headers:
                results["missing_security"].append(h)
                
        return results
    except Exception as e:
        return {"error": str(e)}

def get_dns_records(domain: str):
    """
    Basic DNS enumeration.
    """
    records = {}
    try:
        # A Record (IPv4)
        records['A'] = socket.gethostbyname(domain)
    except: 
        records['A'] = "Not found"

    try:
        # CNAME / Reverse lookup attempt
        records['PTR/CNAME'] = socket.gethostbyaddr(records.get('A', ''))[0]
    except: 
        pass

    return records

def run_pentest_suite(target_input: str):
    """
    Orchestrator for pentest tools.
    """
    report = {}
    
    # 1. Web Headers
    report['web'] = analyze_web_headers(target_input)
    
    # 2. DNS (Only if input looks like a domain, not just an IP)
    # Simple heuristic: if it has letters, run DNS
    if any(c.isalpha() for c in target_input):
        report['dns'] = get_dns_records(target_input)
        
    return report